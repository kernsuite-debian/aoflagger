From: Ole Streicher <olebole@debian.org>
Date: Thu, 29 Sep 2016 20:35:34 +0200
Subject: Build shared lib with SONAME and SOVERSION

---
 src/CMakeLists.txt | 14 ++++++++++----
 1 file changed, 10 insertions(+), 4 deletions(-)

diff --git a/src/CMakeLists.txt b/src/CMakeLists.txt
index 6db670e..dd3c11a 100644
--- a/src/CMakeLists.txt
+++ b/src/CMakeLists.txt
@@ -253,10 +253,15 @@ if(SIGCXX_FOUND)
   set(ALL_LIBRARIES ${ALL_LIBRARIES} ${SIGCXX_LIBRARIES})
 endif(SIGCXX_FOUND)
 
-add_library(aoflagger ${IMAGING_FILES} ${INTERFACE_FILES} ${MSIO_FILES} ${QUALITY_FILES} ${STRATEGY_FILES} ${STRUCTURES_FILES} ${UTIL_FILES})
-target_link_libraries(aoflagger ${ALL_LIBRARIES})
+add_library(aoflagger-lib STATIC ${IMAGING_FILES} ${INTERFACE_FILES} ${MSIO_FILES} ${QUALITY_FILES} ${STRATEGY_FILES} ${STRUCTURES_FILES} ${UTIL_FILES})
+set_target_properties(aoflagger-lib PROPERTIES OUTPUT_NAME aoflagger)
 
-link_libraries(aoflagger)
+add_library(aoflagger-shared SHARED ${IMAGING_FILES} ${INTERFACE_FILES} ${MSIO_FILES} ${QUALITY_FILES} ${STRATEGY_FILES} ${STRUCTURES_FILES} ${UTIL_FILES})
+set_target_properties(aoflagger-shared PROPERTIES OUTPUT_NAME aoflagger)
+SET_TARGET_PROPERTIES(aoflagger-shared PROPERTIES SOVERSION 0)
+target_link_libraries(aoflagger-shared ${ALL_LIBRARIES})
+
+link_libraries(aoflagger-shared)
 
 add_library(aoflaggerremote OBJECT ${REMOTE_FILES})
 set(AOFLAGGERREMOTE_OBJECT $<TARGET_OBJECTS:aoflaggerremote>)
@@ -311,5 +316,6 @@ if(BOOST_ASIO_H_FOUND AND SIGCXX_FOUND AND GTKMM_FOUND)
 	install (TARGETS aoquality aoremoteclient DESTINATION bin)
 endif(BOOST_ASIO_H_FOUND AND SIGCXX_FOUND AND GTKMM_FOUND)
 
-install (TARGETS aoflagger DESTINATION lib) 
+install (TARGETS aoflagger-shared DESTINATION lib/${DEB_BUILD_MULTIARCH}) 
+install (TARGETS aoflagger-lib DESTINATION lib/${DEB_BUILD_MULTIARCH}) 
 install (FILES interface/aoflagger.h DESTINATION include)
